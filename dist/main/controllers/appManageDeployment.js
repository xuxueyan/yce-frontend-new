define(function(){return function($scope,$http,$rootScope,atomicNotifyService,$timeout){$scope.complete=0,$scope.applyData={orgId:localStorage.orgId,userId:localStorage.userId,appName:"",orgName:"",dcIdList:[],deployment:{metadata:{name:"",namespace:"",labels:{name:"",author:localStorage.userName,version:""}},spec:{replicas:1,template:{metadata:{labels:{name:"",author:localStorage.userName,version:""}},spec:{containers:[{name:"",env:[{name:"DB_USER",value:""},{name:"DB_PASS",value:""}],image:"",resources:{limits:{cpu:"",memory:""}},ports:[{name:"",containerPort:null,protocol:""}]}]}}}}};var e={orgId:localStorage.orgId,userId:localStorage.userId},a=yce.api.apply.applyInit($http,e);utils.responseHandler(a,function(e){if(0==e.code){$scope.complete++;var e=JSON.parse(e.data);$scope.applyData.orgName=e.orgName,$scope.applyData.deployment.metadata.namespace=e.orgName,$scope.dataCenters=e.dataCenters,$scope.quotas=e.quotas}}),$scope.slider={value:1,options:{ceil:10,floor:1,showSelectionBar:!0,showTicks:!0,getTickColor:function(e){return"#d8e0f3"}}},$scope.addApplyEnv=function(){$scope.applyData.deployment.spec.template.spec.containers[0].env.push({})},$scope.deleteApplyEnv=function(e){$scope.applyData.deployment.spec.template.spec.containers[0].env.splice(e,1)},$scope.protocolArray=["TCP","UDP"],$scope.addApplyPort=function(){$scope.applyData.deployment.spec.template.spec.containers[0].ports.push({})},$scope.deleteApplyPort=function(e){$scope.applyData.deployment.spec.template.spec.containers[0].ports.splice(e,1)},$scope.applyLabelArray=[],$scope.addApplyLabel=function(){$scope.applyLabelArray.push({})},$scope.deleteApplyLabel=function(e){$scope.applyLabelArray.splice(e,1)},$scope.addApplyHostPath=function(){$scope.applyData.deployment.spec.template.spec.containers[0].volumeMounts?$scope.applyData.deployment.spec.template.spec.containers[0].volumeMounts.push({}):$scope.applyData.deployment.spec.template.spec.containers[0].volumeMounts=[{}]},$scope.deleteApplyHostPath=function(e){$scope.applyData.deployment.spec.template.spec.containers[0].volumeMounts.splice(e,1)},$scope.getImageList=function(){$rootScope.window.select=!0,$scope.imgSelectConfig={id:"select",title:"选择镜像"};var e=yce.api.image.imageList($http);utils.responseHandler(e,function(e){0==e.code&&($scope.imageList=JSON.parse(e.data).images)}),$scope.selectImage=function(e){$rootScope.window.select=!1,e&&($scope.applyData.deployment.spec.template.spec.containers[0].image=e,$scope.applyData.deployment.metadata.labels.version=e.substring(e.lastIndexOf(":")+1))}};var t;$scope.$watch("applyData.appName",function(e){e&&(t&&$timeout.cancel(t),t=$timeout(function(){var a={orgId:localStorage.orgId,userId:localStorage.userId,name:e};utils.responseHandler(yce.api.apply.nameExist($http,a),function(e){1415==e.code?$scope.applyNameExist=!0:$scope.applyNameExist=!1}),$scope.applyData.deployment.metadata.name=e,$scope.applyData.deployment.spec.template.spec.containers[0].name=e,$scope.applyData.deployment.metadata.labels.name=e},350))}),$scope.applySubmit=function(){angular.forEach($scope.applyData.dcIdList,function(e,a){e===!1&&$scope.applyData.dcIdList.splice(a,1)}),$scope.applyData.deployment.spec.template.spec.containers[0].volumeMounts&&angular.forEach($scope.applyData.deployment.spec.template.spec.containers[0].volumeMounts,function(e,a){$scope.applyData.deployment.spec.template.spec.volumes[a].name=e.name}),$scope.applyLabelArray.length>0&&angular.forEach($scope.applyLabelArray,function(e,a){$scope.applyData.deployment.metadata.labels[e.key]=e.value}),$scope.applyData.deployment.metadata.labels=$scope.applyData.deployment.spec.template.metadata.labels;var e=yce.api.apply.applySubmit($http,$scope.applyData);utils.responseHandler(e,function(e){0==e.code?($timeout(function(){window.location.hash="#/appManage"},500),atomicNotifyService.success(e.message,2e3)):atomicNotifyService.error(e.message,2e3)})}}});